"""
  -*- encoding: utf-8 -*-
  @Author: huzhengyu
  @Time  : 2023/10/10 20:00
  @Email: 1121376990@qq.com
  @function ICD to Mongo
"""
import pandas as pd
from pymongo import MongoClient
import pprint

# Step 1: Read Excel file and convert to dict
file_url = "https://raw.githubusercontent.com/HTX2023/ICD/main/ICDcode.xlsx"  # GitHub direct link to the Excel file
data = pd.read_excel(file_url)
icd_dict = data.set_index(data.columns[0]).T.to_dict('records')[0]

# Step 2: Insert the dict into MongoDB
client = MongoClient("mongodb://localhost:27017/")  # Connect to MongoDB
db = client.test_database  # Connect to your database
collection = db["icd_codes"]  # Specify your collection. You can replace "icd_codes" with your desired collection name.
collection.insert_one(icd_dict)  # Insert the data

# Query the collection
results = collection.find()

# Print each document
for document in results:
    pprint.pprint(document)
